[English](https://github.com/Eatin/click2fill/blob/main/README.md)

# Click2Fill

## 概述

Click2Fill 是一个功能强大的思源笔记插件，允许您选择文本，将其发送到配置的 API 端点，并自动将响应附加到文档中。

## 特性

* **文本选择**：选择文档中的任何文本
* **API 集成**：将选中的文本发送到自定义 API 端点
* **动态菜单**：配置多个 API 端点，自定义名称和图标
* **智能菜单显示**：根据选中的文本只显示相关菜单，解决了配置过多显示的问题
* **键盘快捷键**：使用 `⇧⌘I`（Shift+Command+I）快速访问
* **附加内容**：结果添加到选中文本之后，而不是替换它
* **URL 验证**：自动为 URL 添加协议前缀
* **自定义模板**：使用简单模板格式化 API 响应
* **菜单显示方式**：可选择总是显示，或基于关键词/正则表达式匹配显示
* **高级设置面板**：将 headers 和 params 配置移到可折叠的高级设置部分
* **API 请求结果渲染**：自定义 API 响应的渲染方式
* **默认模板值**：提供预配置模板，便于快速设置
* **占位符支持**：在请求参数中使用 `${selectText}` 包含选中的文本
* **默认请求方法**：设置 POST 为默认请求方法，提高兼容性
* **简化请求方法**：仅保留 GET 和 POST 选项，便于配置
* **默认 Demo API**：包含预配置的"随机笑话"API，可立即测试
* **模板默认值**：支持 `${data.type || '默认值'}` 语法
* **数组循环支持**：使用 `${each(array as item)}` 遍历响应中的数组
* **复制到剪贴板**：结果可复制到剪贴板，而不是插入到文档
* **历史记录管理**：保存最近 100 条 API 调用记录
* **低调启动**：对话框默认不激活，启动更干净
* **干净控制台**：减少日志输出，提高性能
* **AI 聊天集成**：支持 AI 聊天功能，可配置代理
* **代理支持**：配置 HTTP、HTTPS 和 SOCKS 代理用于 API 请求
* **用户代理配置**：自定义 API 请求的 User-Agent
* **离线支持**：包含离线资源文件，支持在离线环境中使用

## 安装

1. 从思源笔记集市下载插件
2. 在集市设置中启用插件
3. 配置您的 API 端点（请参阅配置部分）

## 使用方法

1. 在文档中选择文本
2. 按 `⇧⌘I`（Shift+Command+I）
3. 从动态菜单中选择 API 端点
4. API 响应将自动附加到您选择的文本后面

## 配置

### API 端点配置

1. 在文档中选择文本
2. 按 `⇧⌘I`（Shift+Command+I）
3. 点击菜单中的"配置"选项
4. 添加 API 端点，包括：
   - **名称**：菜单项显示名称
   - **图标**：思源笔记图标集中的图标 ID
   - **URL**：API 端点 URL
   - **方法**：HTTP 方法（GET/POST）
   - **Headers**：自定义头信息（JSON 格式）
   - **Params**：自定义参数（JSON 格式）
   - **响应类型**：如何解析响应
   - **模板**：可选的响应格式化模板

### AI 聊天配置

1. 打开思源笔记设置
2. 导航到"AI"部分
3. 配置以下设置：
   - **API Key**：您的 OpenAI API 密钥
   - **API Base URL**：AI API 的基础 URL
   - **API Proxy**：可选的代理服务器 URL（支持 HTTP、HTTPS 和 SOCKS 协议）
     - 示例：`http://localhost:3000` 或 `socks://127.0.0.1:1080`
   - **API User Agent**：可选的自定义 User-Agent 用于 API 请求

## 开发

### 前提条件

* Node.js (v16+)
* pnpm
* 思源笔记 (v3.1.3+)

### 设置

1. 将仓库克隆到您的本地机器
2. 导航到项目目录
3. 安装依赖：`pnpm i`
4. 启动开发服务器：`pnpm run dev`
5. 插件将被编译并可在思源笔记中使用

### 生产构建

```bash
pnpm run build
```

### 项目结构

```
click2fill/
├── src/
│   ├── i18n/            # 国际化文件
│   │   ├── en_US.json
│   │   └── zh_CN.json
│   ├── index.scss       # 插件样式
│   └── index.ts         # 主插件逻辑
├── icon.png             # 插件图标 (160*160)
├── plugin.json          # 插件配置
├── README.md            # 英文文档
├── README_zh_CN.md      # 中文文档
└── CHANGELOG.md         # 版本历史
```

## 键盘快捷键

* **打开 Click2Fill 菜单**：`⇧⌘I`（Shift+Command+I）

## 示例

### 基本用法

1. 选择文本："获取纽约天气"
2. 打开 Click2Fill 菜单
3. 选择您的天气 API 端点
4. 结果将被附加："获取纽约天气
温度：22°C，天气：晴朗"

### 使用模板

如果您配置了如下模板：
```
温度：${temp}°C，天气：${conditions}
```

并且您的 API 返回：
```json
{"temp": 22, "conditions": "晴朗"}
```

结果将被格式化为：
```
温度：22°C，天气：晴朗
```

## 故障排除

### API 请求失败

1. 检查您的 API URL 配置
2. 确保 URL 有正确的协议（http:// 或 https://）
3. 验证 API 端点是否可访问
4. 检查浏览器控制台以获取详细错误信息

### 菜单不显示

1. 确保在按快捷键之前已选择文本
2. 检查插件是否在思源笔记集市中启用
3. 验证键盘快捷键是否冲突

## 更新日志

请参阅 [CHANGELOG.md](https://github.com/Eatin/click2fill/blob/main/CHANGELOG.md) 了解版本历史。

## 许可证

MIT 许可证